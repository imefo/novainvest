<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NovaInvest — داشبورد کاربر</title>

<meta name="description" content="داشبورد NovaInvest: موجودی، پلن‌های فعال، تراکنش‌ها، نمودار رشد سرمایه، پشتیبانی و ارجاع.">
<meta name="theme-color" content="#7c4dff">

<link rel="icon" href='data:image/svg+xml;utf8,
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
  <rect width="256" height="256" rx="48" fill="#0d0d12"/>
  <path d="M64 192V64l96 96V64" fill="none" stroke="%237c4dff" stroke-width="28" stroke-linecap="round" stroke-linejoin="round"/>
  <circle cx="200" cy="56" r="12" fill="%23d4af37"/>
</svg>'>

<style>
  :root{
    --bg:#0d0d12; --panel:#151521; --text:#e8e8f3; --muted:#a4a4bf;
    --accent:#7c4dff; --gold:#d4af37; --ring:rgba(124,77,255,.30);
    --success:#00c853; --danger:#ff5252; --warning:#ffb300;
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Tahoma, Arial, sans-serif;background:
    radial-gradient(1200px 600px at 10% 10%, #1a1430 0%, #0d0d12 40%),
    radial-gradient(1000px 500px at 90% 0%, #221a3d 0%, rgba(13,13,18,1) 50%),
    #0d0d12; color:var(--text);}
  a{color:inherit;text-decoration:none}
  .container{max-width:1200px;margin:0 auto;padding:20px}
  header{position:sticky;top:0;z-index:10;background:#0f0f17cc;border-bottom:1px solid rgba(255,255,255,.06);backdrop-filter:blur(8px)}
  .nav{display:flex;justify-content:space-between;align-items:center;gap:16px}
  .brand{display:flex;gap:10px;align-items:center;font-weight:900}
  .logo{width:34px;height:34px;border-radius:10px;background:
    radial-gradient(120% 120% at 20% 20%, var(--accent) 0%, #4227a6 45%, #1a1430 100%);
    box-shadow:0 0 0 6px rgba(124,77,255,.12), 0 8px 30px rgba(124,77,255,.35)}
  .nav a{padding:10px 12px;border-radius:10px;color:var(--muted)}
  .nav a:hover{background:rgba(255,255,255,.06);color:#fff}
  .btn{border:1px solid rgba(255,255,255,.15);background:#191926;color:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;transition:.2s}
  .btn:hover{transform:translateY(-1px);box-shadow:0 10px 26px var(--ring)}
  .btn.primary{background:var(--accent);border-color:transparent}
  .btn.ghost{background:transparent}
  .btn.danger{background:#2a1518;border-color:#662; color:#ff9a9a}

  .grid{display:grid;gap:16px}
  .grid-2{grid-template-columns:repeat(2,1fr)}
  .grid-3{grid-template-columns:repeat(3,1fr)}
  .grid-4{grid-template-columns:repeat(4,1fr)}
  @media(max-width:1000px){.grid-4{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:720px){.grid-2,.grid-3{grid-template-columns:1fr}}

  .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:18px}
  .title{margin:0 0 12px;font-size:22px}
  .muted{color:var(--muted)}
  .kpi{display:flex;flex-direction:column;gap:6px}
  .kpi .label{color:var(--muted)}
  .kpi .val{font-size:26px;font-weight:900}
  .kpi.success .val{color:var(--success)}
  .kpi.warn .val{color:var(--warning)}
  .kpi.danger .val{color:#ff6b6b}

  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.06);text-align:right}
  th{color:#bfbfda;font-weight:700}
  tr:hover td{background:rgba(255,255,255,.03)}

  .tag{display:inline-block;border:1px solid rgba(255,255,255,.15);padding:4px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
  .tag.ok{border-color:rgba(0,200,83,.4);color:#b9ffd3}
  .tag.fail{border-color:rgba(255,82,82,.5);color:#ffc0c0}
  .tag.pending{border-color:rgba(255,179,0,.5);color:#ffe6b3}
  .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .note{font-size:12px;color:var(--muted)}
  footer{margin-top:40px;border-top:1px solid rgba(255,255,255,.08);padding:18px;text-align:center;color:var(--muted)}
  .chip{display:inline-block;background:rgba(124,77,255,.15);border:1px solid rgba(124,77,255,.35);padding:6px 10px;border-radius:999px;font-size:12px}
  .canvas-wrap{position:relative;width:100%;height:280px}
  canvas{width:100%;height:100%;display:block}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media(max-width:800px){.row{grid-template-columns:1fr}}
  input,textarea{width:100%;background:#1a1a2b;border:1px solid rgba(255,255,255,.12);color:#fff;border-radius:12px;padding:12px;outline:none}
  input:focus,textarea:focus{box-shadow:0 0 0 4px var(--ring)}
  label{display:block;margin-bottom:6px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<header>
  <div class="container nav">
    <div class="brand"><span class="logo"></span> NovaInvest</div>
    <nav>
      <a href="/">خانه</a>
      <a href="/#plans">پلن‌ها</a>
      <a href="/#contact">تماس</a>
      <a class="btn ghost" href="#" id="logoutBtn">خروج</a>
    </nav>
  </div>
</header>

<main class="container">

  <!-- KPIs -->
  <section class="grid grid-4">
    <div class="card kpi">
      <span class="label">موجودی کل</span>
      <span class="val" id="kpiBalance">0 USDT</span>
    </div>
    <div class="card kpi">
      <span class="label">پلن‌های فعال</span>
      <span class="val" id="kpiPlans">0</span>
    </div>
    <div class="card kpi success">
      <span class="label">سود ماه جاری</span>
      <span class="val" id="kpiPnl">0 USDT</span>
    </div>
    <div class="card kpi warn">
      <span class="label">برداشت‌های در انتظار</span>
      <span class="val" id="kpiPending">0</span>
    </div>
  </section>

  <!-- Charts -->
  <section class="grid grid-2" style="margin-top:16px">
    <div class="card">
      <div class="title">نمودار رشد سرمایه</div>
      <div class="canvas-wrap"><canvas id="lineChart"></canvas></div>
      <p class="note">* داده‌ها نمایشی هستند.</p>
    </div>
    <div class="card">
      <div class="title">ترکیب پلن‌ها</div>
      <div class="canvas-wrap"><canvas id="pieChart"></canvas></div>
      <p class="note">* توزیع سرمایه بین پلن‌های فعال.</p>
    </div>
  </section>

  <!-- Active Plans -->
  <section class="card" style="margin-top:16px">
    <div class="title">پلن‌های فعال</div>
    <div class="toolbar">
      <span class="chip">AI-1M (۱۲٪/ماه)</span>
      <button class="btn" onclick="mockActivatePlan()">افزودن پلن نمایشی</button>
    </div>
    <div style="overflow:auto;margin-top:10px">
      <table>
        <thead>
          <tr><th>نام پلن</th><th>سرمایه اصلی</th><th>نرخ ماهانه</th><th>تاریخ شروع</th><th>تاریخ پایان</th><th>وضعیت</th></tr>
        </thead>
        <tbody id="plansBody"></tbody>
      </table>
    </div>
  </section>

  <!-- Transactions -->
  <section class="card" style="margin-top:16px">
    <div class="title">تراکنش‌ها</div>
    <div class="toolbar">
      <button class="btn" onclick="mockDeposit()">واریز نمایشی +100</button>
      <button class="btn danger" onclick="mockWithdraw()">برداشت نمایشی -50</button>
      <button class="btn primary" onclick="exportCSV()">خروجی CSV</button>
      <span class="note">* برای تست UI</span>
    </div>
    <div style="overflow:auto;margin-top:10px">
      <table>
        <thead>
          <tr><th>تاریخ</th><th>نوع</th><th>مبلغ (USDT)</th><th>توضیحات</th><th>وضعیت</th></tr>
        </thead>
        <tbody id="txBody"></tbody>
      </table>
    </div>
  </section>

  <!-- Announcements & Support -->
  <section class="grid grid-2" style="margin-top:16px">
    <div class="card">
      <div class="title">اطلاعیه‌ها</div>
      <ul id="newsList" class="muted" style="line-height:1.9;margin:0;padding-right:18px">
        <li>به NovaInvest خوش آمدید. این نسخه نمایشی است.</li>
        <li>پلن جدید به‌زودی افزوده می‌شود.</li>
        <li>امکان گزارش‌گیری CSV فعال شد.</li>
      </ul>
    </div>
    <div class="card">
      <div class="title">تیکت پشتیبانی</div>
      <div class="row">
        <div>
          <label>عنوان</label>
          <input id="tkTitle" placeholder="مثال: سوال درباره پلن">
        </div>
        <div>
          <label>اولویت</label>
          <input id="tkPriority" placeholder="عادی / بالا">
        </div>
      </div>
      <label>پیام</label>
      <textarea id="tkMsg" rows="4" placeholder="متن پیام شما..."></textarea>
      <div class="toolbar" style="margin-top:10px">
        <button class="btn primary" onclick="submitTicket()">ارسال تیکت</button>
        <span class="note" id="tkOut"></span>
      </div>
    </div>
  </section>

  <!-- Referral -->
  <section class="card" style="margin-top:16px">
    <div class="title">سیستم ارجاع</div>
    <p class="muted">لینک دعوت اختصاصی شما:</p>
    <div class="row">
      <input id="refLink" readonly>
      <button class="btn" onclick="copyRef()">کپی لینک</button>
    </div>
    <p class="note" id="refStats" style="margin-top:8px">زیرمجموعه‌ها: 0 — پاداش: 0 USDT (نمایشی)</p>
  </section>

</main>

<footer>
  © <span id="year"></span> NovaInvest — تمامی حقوق محفوظ است.
</footer>

<script>
  // ----- Demo State (shared with your main site if same LS_KEY) -----
  const LS_KEY = "novainvest_demo_v1";
  const ST = JSON.parse(localStorage.getItem(LS_KEY) || '{"users":[],"session":null,"balance":0,"plans":[],"txs":[],"pending":0,"ref":{"count":0,"reward":0}}');

  // Utils
  const fmt = n => (Number(n).toFixed(2));
  const ts = t => new Date(t).toLocaleString('fa-IR');

  // Mock helpers
  function mockDeposit(){
    ST.balance += 100;
    ST.txs = ST.txs || [];
    ST.txs.unshift({t:'DEPOSIT', amt:100, ts:Date.now(), meta:'واریز نمایشی', status:'OK'});
    persist(); render(); drawCharts();
  }
  function mockWithdraw(){
    ST.balance = Math.max(0, ST.balance - 50);
    ST.txs = ST.txs || [];
    ST.txs.unshift({t:'WITHDRAW', amt:-50, ts:Date.now(), meta:'برداشت نمایشی', status:'PENDING'});
    ST.pending = (ST.pending||0) + 1;
    persist(); render(); drawCharts();
  }
  function mockActivatePlan(){
    const price = 100;
    if(ST.balance < price){ alert('موجودی کافی نیست. ابتدا واریز کنید.'); return; }
    ST.balance -= price;
    ST.plans = ST.plans || [];
    ST.plans.push({name:'AI-1M', principal:price, rate:0.12, start:Date.now(), end: Date.now()+30*24*3600*1000, status:'ACTIVE'});
    ST.txs = ST.txs || [];
    ST.txs.unshift({t:'BUY_PLAN', amt:-price, ts:Date.now(), meta:'AI-1M', status:'OK'});
    persist(); render(); drawCharts();
  }

  // Referral
  function setupReferral(){
    const base = location.origin || 'https://example.com';
    const uid = (ST.session || 'guest').replace(/[^a-zA-Z0-9]/g,'');
    const link = base + '/?ref=' + uid;
    document.getElementById('refLink').value = link;
    const c = (ST.ref && ST.ref.count) || 0;
    const r = (ST.ref && ST.ref.reward) || 0;
    document.getElementById('refStats').textContent = `زیرمجموعه‌ها: ${c} — پاداش: ${fmt(r)} USDT (نمایشی)`;
  }
  function copyRef(){
    const el = document.getElementById('refLink');
    el.select(); el.setSelectionRange(0,99999);
    document.execCommand('copy');
    alert('کپی شد!');
  }

  // Support
  function submitTicket(){
    const t = document.getElementById('tkTitle').value.trim();
    const p = document.getElementById('tkPriority').value.trim() || 'عادی';
    const m = document.getElementById('tkMsg').value.trim();
    if(!t || !m){ document.getElementById('tkOut').textContent = 'عنوان و پیام ضروری است.'; return; }
    ST.tickets = ST.tickets || [];
    ST.tickets.unshift({title:t, priority:p, msg:m, ts:Date.now(), status:'OPEN'});
    document.getElementById('tkOut').textContent = 'تیکت ثبت شد (نمایشی).';
    document.getElementById('tkTitle').value='';
    document.getElementById('tkPriority').value='';
    document.getElementById('tkMsg').value='';
    persist();
  }

  // Export CSV
  function exportCSV(){
    const rows = [['date','type','amount','meta','status']];
    (ST.txs||[]).forEach(x=> rows.push([new Date(x.ts).toISOString(), x.t, x.amt, x.meta||'', x.status||'']));
    const csv = rows.map(r=> r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'transactions.csv'; a.click();
    URL.revokeObjectURL(url);
  }

  // Render KPIs / Tables
  function render(){
    document.getElementById('year').textContent = new Date().getFullYear();
    const pnl = (ST.plans||[]).reduce((s,p)=> s + p.principal * p.rate, 0);
    document.getElementById('kpiBalance').textContent = fmt(ST.balance) + ' USDT';
    document.getElementById('kpiPlans').textContent = (ST.plans||[]).filter(p=>p.status==='ACTIVE').length;
    document.getElementById('kpiPnl').textContent = fmt(pnl) + ' USDT';
    document.getElementById('kpiPending').textContent = ST.pending||0;

    // Plans table
    const pb = document.getElementById('plansBody');
    pb.innerHTML = (ST.plans||[]).map(p=>{
      const start = ts(p.start), end = ts(p.end);
      const tag = p.status==='ACTIVE' ? '<span class="tag ok">فعال</span>' : '<span class="tag">پایان‌یافته</span>';
      return `<tr>
        <td>${p.name}</td>
        <td>${fmt(p.principal)} USDT</td>
        <td>${(p.rate*100).toFixed(0)}٪</td>
        <td>${start}</td>
        <td>${end}</td>
        <td>${tag}</td>
      </tr>`;
    }).join('') || `<tr><td colspan="6" class="muted">پلن فعالی وجود ندارد.</td></tr>`;

    // Tx table
    const tb = document.getElementById('txBody');
    tb.innerHTML = (ST.txs||[]).map(x=>{
      const statusTag = x.status==='OK' ? '<span class="tag ok">تأیید</span>' :
                        x.status==='PENDING' ? '<span class="tag pending">در انتظار</span>' :
                        '<span class="tag fail">رد</span>';
      const amount = x.amt>0 ? `+${fmt(x.amt)}` : fmt(x.amt);
      return `<tr>
        <td>${ts(x.ts)}</td>
        <td>${x.t}</td>
        <td style="direction:ltr">${amount}</td>
        <td>${x.meta||''}</td>
        <td>${statusTag}</td>
      </tr>`;
    }).join('') || `<tr><td colspan="5" class="muted">تراکنشی ثبت نشده است.</td></tr>`;
  }

  // Minimal Canvas Charts (no external libs)
  function drawLine(ctx, data, color){
    const W = ctx.canvas.width = ctx.canvas.clientWidth * devicePixelRatio;
    const H = ctx.canvas.height = ctx.canvas.clientHeight * devicePixelRatio;
    ctx.scale(devicePixelRatio, devicePixelRatio);
    ctx.clearRect(0,0,W,H);
    const pad = 20; const w = W/devicePixelRatio - pad*2; const h = H/devicePixelRatio - pad*2;
    const max = Math.max(...data, 1); const min = Math.min(...data, 0);
    const nx = i => pad + (i/(data.length-1)) * w;
    const ny = v => pad + (1 - (v-min)/(max-min || 1)) * h;
    ctx.lineWidth = 2; ctx.strokeStyle = color; ctx.beginPath();
    data.forEach((v,i)=>{ const x=nx(i), y=ny(v); i?ctx.lineTo(x,y):ctx.moveTo(x,y); });
    ctx.stroke();
    // gradient fill
    const grad = ctx.createLinearGradient(0,pad,0,h+pad);
    grad.addColorStop(0, 'rgba(124,77,255,.35)');
    grad.addColorStop(1, 'rgba(124,77,255,0)');
    ctx.fillStyle = grad; ctx.beginPath();
    data.forEach((v,i)=>{ const x=nx(i), y=ny(v); i?ctx.lineTo(x,y):ctx.moveTo(x,y); });
    ctx.lineTo(pad+w, pad+h); ctx.lineTo(pad, pad+h); ctx.closePath(); ctx.fill();
  }
  function drawPie(ctx, parts, colors){
    const W = ctx.canvas.width = ctx.canvas.clientWidth * devicePixelRatio;
    const H = ctx.canvas.height = ctx.canvas.clientHeight * devicePixelRatio;
    ctx.scale(devicePixelRatio, devicePixelRatio);
    ctx.clearRect(0,0,W,H);
    const cx = (W/devicePixelRatio)/2, cy = (H/devicePixelRatio)/2, r = Math.min(cx,cy)-10;
    const sum = parts.reduce((a,b)=>a+b,0) || 1;
    let ang = -Math.PI/2;
    parts.forEach((p,i)=>{
      const slice = (p/sum)*Math.PI*2;
      ctx.beginPath(); ctx.moveTo(cx,cy);
      ctx.arc(cx,cy,r,ang,ang+slice); ctx.closePath();
      ctx.fillStyle = colors[i % colors.length]; ctx.fill();
      ang += slice;
    });
    // inner cut for donut
    ctx.globalCompositeOperation='destination-out';
    ctx.beginPath(); ctx.arc(cx,cy,r*0.55,0,Math.PI*2); ctx.fill();
    ctx.globalCompositeOperation='source-over';
  }

  function drawCharts(){
    // Construct demo balance history from txs
    let bal = 0;
    const days = 12;
    const hist = [];
    const txs = (ST.txs||[]).slice().sort((a,b)=>a.ts-b.ts);
    const start = Date.now() - days*24*3600*1000;
    for(let i=0;i<days;i++){
      const t0 = start + i*24*3600*1000;
      txs.filter(x=> x.ts < t0).forEach(x=> bal += x.amt); // naive
      hist.push(Math.max(0, bal));
      bal = 0; // reset accumulation per day window (for demo look)
    }
    const lineCtx = document.getElementById('lineChart').getContext('2d');
    drawLine(lineCtx, hist.map(x=>x+ (Math.random()*50)), '#7c4dff');

    // Pie by plan principals
    const sums = {};
    (ST.plans||[]).forEach(p=> sums[p.name] = (sums[p.name]||0)+ (p.principal||0));
    const parts = Object.values(sums);
    if(parts.length===0) parts.push(1);
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    drawPie(pieCtx, parts, ['#7c4dff','#d4af37','#00c853','#ffb300','#29b6f6']);
  }

  function persist(){ localStorage.setItem(LS_KEY, JSON.stringify(ST)); }

  // Logout (demo)
  document.getElementById('logoutBtn').addEventListener('click', (e)=>{
    e.preventDefault();
    ST.session = null; persist();
    alert('خروج انجام شد (نمایشی). به صفحه اصلی برمی‌گردید.');
    location.href = '/';
  });

  // Boot
  (function init(){
    // Seed demo if empty
    if(!ST.txs || ST.txs.length===0){
      ST.txs = [
        {t:'DEPOSIT', amt:200, ts:Date.now()-6*24*3600*1000, meta:'واریز اولیه', status:'OK'},
        {t:'BUY_PLAN', amt:-100, ts:Date.now()-5*24*3600*1000, meta:'AI-1M', status:'OK'},
        {t:'DEPOSIT', amt:150, ts:Date.now()-3*24*3600*1000, meta:'شارژ', status:'OK'},
      ];
      ST.balance = 250;
      ST.plans = [{name:'AI-1M', principal:100, rate:0.12, start:Date.now()-5*24*3600*1000, end:Date.now()+25*24*3600*1000, status:'ACTIVE'}];
      ST.pending = 0;
      persist();
    }
    document.getElementById('year').textContent = new Date().getFullYear();
    render(); setupReferral(); drawCharts();
    window.addEventListener('resize', drawCharts);
  })();
</script>
</body>
</html>
